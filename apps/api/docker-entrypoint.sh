#!/bin/sh
set -e

echo "üîÑ –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ PostgreSQL..."
until pg_isready -h postgres -U ${POSTGRES_USER:-postgres} || exit 1; do
  sleep 1
done

echo "üì¶ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π Prisma..."
npx prisma migrate deploy || true

echo "üîß –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client..."
npx prisma generate

echo "üå± –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)..."
npx prisma db seed || echo "‚ö†Ô∏è Seed –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω (–≤–æ–∑–º–æ–∂–Ω–æ, –¥–∞–Ω–Ω—ã–µ —É–∂–µ –µ—Å—Ç—å)"

echo "üöÄ –ó–∞–ø—É—Å–∫ API —Å–µ—Ä–≤–µ—Ä–∞..."
exec node dist/server.js

