# ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å PostgreSQL

## üîß –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã Prisma
- [x] –°—Ö–µ–º–∞ Prisma –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ PostgreSQL (`provider = "postgresql"`)
- [x] JSON –ø–æ–ª—è –∏–∑–º–µ–Ω–µ–Ω—ã —Å `String` –Ω–∞ `Json`
- [x] –í—Å–µ —Å–≤—è–∑–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
- [x] –£—Ç–∏–ª–∏—Ç—ã JSON –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–æ–∏–º–∏ —Ç–∏–ø–∞–º–∏ –ë–î
- [x] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [x] –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
- [x] `docker-compose.yml` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è PostgreSQL
- [x] –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [x] `docker-entrypoint.sh` –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL

## üöÄ –®–∞–≥–∏ –¥–µ–ø–ª–æ—è

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# PostgreSQL
POSTGRES_DB=order_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=<–°–ò–õ–¨–ù–´–ô_–ü–ê–†–û–õ–¨_–ú–ò–ù–ò–ú–£–ú_32_–°–ò–ú–í–û–õ–ê>
POSTGRES_PORT=5432

# DATABASE_URL –¥–ª—è API
DATABASE_URL=postgresql://postgres:<–ü–ê–†–û–õ–¨>@postgres:5432/order_db

# JWT (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ò–ó–ú–ï–ù–ò–¢–ï!)
JWT_SECRET=<–°–õ–£–ß–ê–ô–ù–´–ô_–°–ï–ö–†–ï–¢_–ú–ò–ù–ò–ú–£–ú_32_–°–ò–ú–í–û–õ–ê>
JWT_REFRESH_SECRET=<–î–†–£–ì–û–ô_–°–õ–£–ß–ê–ô–ù–´–ô_–°–ï–ö–†–ï–¢_–ú–ò–ù–ò–ú–£–ú_32_–°–ò–ú–í–û–õ–ê>
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_EXPIRY=7d

# CORS (—É–∫–∞–∂–∏—Ç–µ –≤–∞—à–∏ –¥–æ–º–µ–Ω—ã)
CORS_ORIGIN=https://yourdomain.com,https://admin.yourdomain.com

# –ü–æ—Ä—Ç—ã
WEB_PORT=3000
ADMIN_PORT=3001
API_PORT=4000
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π PostgreSQL

```bash
cd apps/api

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ DATABASE_URL
export DATABASE_URL="postgresql://postgres:your_password@localhost:5432/order_db"

# –°–æ–∑–¥–∞–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
npx prisma migrate dev --name init_postgresql

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
npx prisma migrate status
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d --build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f api
```

### –®–∞–≥ 4: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ docker-entrypoint.sh
# –ù–æ –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é:
docker-compose exec api npx prisma migrate deploy
```

### –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

```bash
docker-compose exec api npm run create-admin-eterno
```

### –®–∞–≥ 6: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

- [ ] API –¥–æ—Å—Ç—É–ø–µ–Ω: `curl http://localhost:4000/health`
- [ ] PostgreSQL —Ä–∞–±–æ—Ç–∞–µ—Ç: `docker-compose exec postgres psql -U postgres -d order_db -c "SELECT 1;"`
- [ ] –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞: `http://localhost:3001`
- [ ] –í–µ–±-—Å–∞–π—Ç –¥–æ—Å—Ç—É–ø–µ–Ω: `http://localhost:3000`

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

1. **–ü–∞—Ä–æ–ª–∏:**
   - [ ] –ò–∑–º–µ–Ω–µ–Ω—ã –≤—Å–µ –ø–∞—Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
   - [ ] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
   - [ ] –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ

2. **–î–æ—Å—Ç—É–ø –∫ –ë–î:**
   - [ ] PostgreSQL –ø–æ—Ä—Ç –Ω–µ –æ—Ç–∫—Ä—ã—Ç –Ω–∞—Ä—É–∂—É
   - [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω firewall
   - [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è SSL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

3. **JWT —Å–µ–∫—Ä–µ—Ç—ã:**
   - [ ] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å–ª—É—á–∞–π–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã
   - [ ] –†–∞–∑–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è access –∏ refresh —Ç–æ–∫–µ–Ω–æ–≤
   - [ ] –•—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–µ –≤ –∫–æ–¥–µ

4. **CORS:**
   - [ ] –£–∫–∞–∑–∞–Ω—ã —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –¥–æ–º–µ–Ω—ã
   - [ ] –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `*` –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤

## üìä –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –±—ç–∫–∞–ø–∞:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç backup.sh
#!/bin/bash
BACKUP_DIR="/backups"
DATE=$(date +%Y%m%d_%H%M%S)
docker-compose exec -T postgres pg_dump -U postgres order_db > "$BACKUP_DIR/backup_$DATE.sql"

# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00)
# 0 2 * * * /path/to/backup.sh
```

### –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞:

```bash
docker-compose exec postgres pg_dump -U postgres order_db > backup_$(date +%Y%m%d_%H%M%S).sql
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞:

```bash
docker-compose exec -T postgres psql -U postgres order_db < backup.sql
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoints:

```bash
# Health check
curl http://localhost:4000/health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
curl -X POST http://localhost:4000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"admin@example.com","password":"password"}'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
docker-compose exec postgres psql -U postgres -d order_db

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
\dt

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
SELECT COUNT(*) FROM users;
SELECT COUNT(*) FROM projects;
```

## üìù –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:

1. **–õ–æ–≥–∏:**
   - [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω —Å–±–æ—Ä –ª–æ–≥–æ–≤
   - [ ] –õ–æ–≥–∏ —Ä–æ—Ç–∏—Ä—É—é—Ç—Å—è
   - [ ] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—é—Ç—Å—è

2. **–ú–µ—Ç—Ä–∏–∫–∏:**
   - [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ë–î
   - [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ API
   - [ ] –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö

3. **–ó–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã:**
   - [ ] Health checks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
   - [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å–±–æ—è—Ö

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –ë–î:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ PostgreSQL
docker-compose ps postgres

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs postgres

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
docker-compose exec postgres psql -U postgres -d order_db
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –º–∏–≥—Ä–∞—Ü–∏–π
docker-compose exec api npx prisma migrate status

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –≤—Ä—É—á–Ω—É—é
docker-compose exec api npx prisma migrate deploy

# –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client
docker-compose exec api npx prisma generate
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [POSTGRESQL_MIGRATION.md](./POSTGRESQL_MIGRATION.md) - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- [CREATE_POSTGRESQL_MIGRATION.md](./apps/api/CREATE_POSTGRESQL_MIGRATION.md) - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –º–∏–≥—Ä–∞—Ü–∏–π
- [DEPLOY.md](./apps/api/DEPLOY.md) - –û–±—â–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–µ–ø–ª–æ—é

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω
- [ ] –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

